from selenium import webdriver
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.common.by import By
from bs4 import BeautifulSoup
import numpy as np
import time
import requests

try:
    options = webdriver.ChromeOptions()
    options.add_argument('--user-data-dir=default')
    options.add_argument("--window-size=1300,900")
    driver = webdriver.Chrome(options=options)
    driver.get("https://sleeper.app/leagues/599841620514373632")

    # Move to standings tab
    driver.find_element(By.ID, "standings-tab").click()
    time.sleep(1)

    page_source = driver.page_source
finally:
    driver.quit()

# Authoritative team ordering...
teams_correctly_ordered = ['Daniel', 'Torry', 'Mitch', 'Ryan', 'Parm', 'Mike', 'James', 'AJ',
       'David', 'Bryan'] 

def extract_data(page_source):
    owners = {'@ryanpdwyer': 'Ryan',
 '@br57': 'Bryan',
 '@mklink': 'Mitch',
 '@DavidAnd': 'David',
 '@daniel_reichl': 'Daniel',
 '@ajkahle': 'AJ',
 '@JayRStorm': 'James',
 '@Parm123': 'Parm',
 '@mjgouvion': 'Mike',
 '@Torry28': 'Torry'}

    soup = BeautifulSoup(page_source, 'lxml')
    matchups = soup.find('div', class_='league-matchups')
    team_ids = matchups.find_all('div', class_="team-name")
    score_els = matchups.find_all('div', class_="score")
    proj_els = matchups.find_all('div', class_="projections")

    teams = [owners[t.text] for t in team_ids]
    scores = np.array([float(el.text.replace('-', '0')) for el in score_els])
    projs = np.array([float(el.text) for el in proj_els])
    return (teams, scores, projs)



players_out = {'1023': 'C',
 '7328': 'LB',
 '608': 'NT',
 '6818': 'DT',
 '6992': 'RB',
 '7224': 'SS',
 '2025': 'WR',
 '3364': 'CB',
 '2316': 'CB',
 '6851': 'DE',
 '7059': 'LB',
 '6572': 'G',
 '7064': 'RB',
 '6799': 'DB',
 '6271': 'WR',
 '4179': 'QB',
 '4606': 'LB',
 '7000': 'LB',
 '58': 'TE',
 '754': 'DT',
 '6089': 'TE',
 '3852': 'WR',
 '5982': 'DB',
 '1550': 'QB',
 '4458': 'CB',
 '5308': 'DE',
 '5376': 'LB',
 '7119': 'DB',
 '6510': 'DT',
 '6906': 'WR',
 '6328': 'CB',
 '4330': 'WR',
 '2339': 'T',
 '6657': 'DE',
 '4371': 'NT',
 '1181': 'LB',
 '6153': 'RB',
 '1833': 'RB',
 '3763': 'DT',
 '6141': 'LB',
 '2535': 'LB',
 '928': 'WR',
 '1160': 'LB',
 '6176': 'LB',
 '6997': 'LB',
 '5091': 'CB',
 '4838': 'OL',
 '6948': 'DT',
 '1472': 'CB',
 '2066': 'G',
 '6123': 'CB',
 '5045': 'WR',
 '4770': 'WR',
 '5880': 'WR',
 '5423': 'T',
 '5051': 'CB',
 '5911': 'WR',
 '3308': 'DT',
 '6007': 'RB',
 '2546': 'CB',
 '2348': 'LB',
 '1548': 'DT',
 '6770': 'QB',
 '2003': 'WR',
 '1346': 'WR',
 '2724': 'LB',
 '1066': 'DB',
 '3446': 'DE',
 '4214': 'WR',
 '4188': 'SS',
 '3721': 'CB',
 '6910': 'DE',
 '4240': 'DT',
 '7145': 'DE',
 '2860': 'CB',
 '5980': 'RB',
 '5107': 'RB',
 '4342': 'WR',
 '2006': 'C',
 '3680': 'LB',
 '6235': 'DE',
 '4285': 'WR',
 '5856': 'T',
 '5868': 'T',
 '4141': 'SS',
 '2152': 'QB',
 '5112': 'RB',
 '3207': 'NT',
 '2338': 'SS',
 '1702': 'G',
 '6809': 'CB',
 '4286': 'LB',
 '3244': 'LB',
 '5375': 'SS',
 '5127': 'QB',
 '289': 'QB',
 '6165': 'WR',
 '3217': 'DE',
 '1421': 'G',
 '5659': 'DT',
 '391': 'K',
 '6426': 'T',
 '4985': 'RB',
 '7027': 'DB',
 '956': 'RB',
 '1502': 'RB',
 '1916': 'WR',
 '7413': 'G',
 '5075': 'LB',
 '358': 'T',
 '5989': 'DT',
 '4323': 'TE',
 '3266': 'CB',
 '4982': 'CB',
 '4991': 'G',
 '6829': 'CB',
 '1098': 'G',
 '4995': 'TE',
 '1058': 'G',
 '4451': 'WR',
 '2425': 'SS',
 '5889': 'RB',
 '7080': 'WR',
 '1997': 'T',
 '1875': 'LB',
 '4162': 'WR',
 '6348': 'LB',
 '3668': 'TE',
 '4145': 'LB',
 '1340': 'T',
 '4050': 'WR',
 '5956': 'T',
 '3322': 'NT',
 '5027': 'T',
 '1728': 'C',
 '1011': 'C',
 '3269': 'WR',
 '5021': 'LB',
 '1633': 'CB',
 '2645': 'CB',
 '2192': 'G',
 '3279': 'SS',
 '3813': 'CB',
 '6217': 'LB',
 '6060': 'CB',
 '4878': 'WR',
 '6963': 'RB',
 '2078': 'WR',
 '4167': 'T',
 '2109': 'G',
 '1663': 'DT',
 '6762': 'TE',
 '5290': 'WR',
 '6494': 'NT',
 '3559': 'CB',
 '4073': 'DE',
 '5074': 'LB',
 '1577': 'LB',
 '3178': 'WR',
 '5891': 'T',
 '2386': 'G',
 '4037': 'WR',
 '6518': 'DE',
 '4104': 'T',
 '5514': None,
 '3867': 'DE',
 '2168': 'RB',
 '2671': 'K',
 '5171': 'TE',
 '1387': 'RB',
 '5368': 'CB',
 '1933': 'T',
 '1312': 'WR',
 '4157': 'RB',
 '7053': 'SS',
 '6883': 'T',
 '2495': 'TE',
 '4353': 'FB',
 '2086': 'C',
 '4603': 'DE',
 '5382': 'CB',
 '6477': 'ILB',
 '5996': 'DE',
 '7384': 'DB',
 '1287': 'K',
 '3195': 'DE',
 '2468': 'P',
 '2818': 'P',
 '7015': 'TE',
 '5988': 'T',
 '44': 'LB',
 '5139': 'WR',
 '6919': 'TE',
 '1837': 'QB',
 '6639': 'CB',
 '6835': 'C',
 '1077': 'WR',
 '3278': 'WR',
 '5052': 'RB',
 '2324': 'T',
 '4927': 'DE',
 '4241': 'DE',
 '537': 'C',
 '5166': 'WR',
 '2393': 'DE',
 '5668': 'G',
 '5923': 'DE',
 '4881': 'QB',
 '4055': 'TE',
 '2460': 'TE',
 '6009': 'CB',
 '6405': 'CB',
 '6209': 'WR',
 '343': 'SS',
 '2801': 'WR',
 '676': 'RB',
 '6432': 'LB',
 '1359': 'CB',
 '1141': 'DE',
 '3423': 'WR',
 '7226': 'DB',
 '5182': 'C',
 '1947': 'DE',
 '3283': 'T',
 '6579': 'DB',
 '1854': 'WR',
 '2344': 'NT',
 '7050': 'TE',
 '5162': 'RB',
 '1965': 'DT',
 '4030': 'LB',
 '3162': 'T',
 '5409': 'TE',
 '7453': 'DB',
 '7452': 'WR',
 '6828': 'RB',
 '1308': 'FB',
 '4151': 'TE',
 '905': 'T',
 '6528': 'K',
 '6612': 'LB',
 '6990': 'LB',
 '4082': 'WR',
 '6157': 'NT',
 '5766': 'CB',
 '2964': 'G',
 '5342': 'DE',
 '2238': 'WR',
 '1703': 'SS',
 '5178': 'DB',
 '6306': 'C',
 '7446': 'K',
 '6114': 'G',
 '4277': 'DB',
 '2583': 'WR',
 '6003': 'LB',
 '871': 'LB',
 '7200': 'CB',
 '1999': 'LB',
 '6640': 'DB',
 '4865': 'LS',
 '6695': 'CB',
 '823': 'LB',
 '7467': 'P',
 '6784': 'DT',
 '6966': 'RB',
 '2014': 'G',
 '7254': 'LB',
 '4424': 'CB',
 '6977': 'LB',
 '4647': 'TE',
 '7082': 'TE',
 '6854': 'DE',
 '3192': 'CB',
 '2366': 'G',
 '6843': 'TE',
 '7456': 'DE',
 '2184': 'DB',
 '6569': 'G',
 '2327': 'LB',
 '3527': 'CB',
 '5214': 'CB',
 '2395': 'NT',
 '6714': 'CB',
 '4185': 'G',
 '7150': 'CB',
 '5495': 'DE',
 '4284': 'T',
 '1283': 'CB',
 '3441': 'C',
 '1984': 'WR',
 '2141': 'C',
 '5450': 'LB',
 '2944': 'TE',
 '2424': 'T',
 '6635': 'G',
 '536': 'WR',
 '7451': 'LB',
 '1826': 'C',
 '5866': 'SS',
 '4571': 'TE',
 '6069': 'WR',
 '6181': 'TE',
 '4468': 'TE',
 '5123': 'RB',
 '982': 'FB',
 '3245': 'T',
 '6119': 'LB',
 '5066': 'DT',
 '7101': 'RB',
 '5012': 'TE',
 '4473': 'FS',
 '1329': 'WR',
 '4213': 'LB',
 '6970': 'TE',
 '4018': 'RB',
 '4069': 'DE',
 '525': 'LS',
 '6885': 'RB',
 '4152': 'RB',
 '4335': 'QB',
 '5130': 'WR',
 '6187': 'RB',
 '6793': 'T',
 '5189': 'K',
 '7448': 'G',
 '7216': 'TE',
 '5946': 'CB',
 '667': 'NT',
 '4136': 'CB',
 '2317': 'DT',
 '3439': 'C',
 '6467': 'DE',
 '647': 'G',
 '344': 'WR',
 '1192': 'LB',
 '2351': 'SS',
 '2214': 'TE',
 '5025': 'SS',
 '5986': 'DE',
 '5882': 'SS',
 '6314': 'CB',
 '6936': 'P',
 '5079': 'CB',
 '3362': 'QB',
 '5305': 'LB',
 '7425': 'RB',
 '4696': 'RB',
 '3382': 'DE',
 '5884': 'WR',
 '1519': 'G',
 '4479': 'WR',
 '2357': 'DT',
 '4132': 'DE',
 '1038': 'LB',
 '4529': 'CB',
 '3467': 'K',
 '6806': 'RB',
 '3669': 'CB',
 '4597': 'C',
 '842': 'T',
 '6315': 'LB',
 '5843': 'LB',
 '4058': 'DE',
 '125': 'DT',
 '2391': 'RB',
 '6023': 'CB',
 '1545': 'CB',
 '6132': 'LB',
 '7462': 'WR',
 '6908': 'RB',
 '6862': 'T',
 '5116': 'RB',
 '3969': 'RB',
 '147': 'WR',
 '5840': 'DE',
 '6917': 'DB',
 '1513': 'DE',
 '3320': 'T',
 '7247': 'DE',
 '2334': 'WR',
 '3526': 'DT',
 '902': 'WR',
 '3841': 'CB',
 '4034': 'RB',
 '2228': 'CB',
 '5088': 'LB',
 '5348': 'LB',
 '1120': 'LB',
 '5924': 'WR',
 '7366': 'DB',
 '6231': 'QB',
 '3808': 'SS',
 '515': 'TE',
 '868': 'TE',
 '4552': 'LB',
 '5307': 'LB',
 '4217': 'TE',
 '1788': 'NT',
 '5673': 'LB',
 '4525': 'CB',
 'CAR': 'DEF',
 '1180': 'DE',
 '3048': 'TE',
 '5858': 'T',
 '5705': 'WR',
 '7246': 'T',
 '1040': 'LB',
 '4146': 'WR',
 '4940': 'TE',
 '202': 'T',
 '6812': 'DE',
 '5315': 'LB',
 '1222': 'T',
 '1540': 'CB',
 '2330': 'LB',
 '641': 'T',
 '2023': 'WR',
 '5301': 'CB',
 '5816': 'DE',
 '594': 'DE',
 '5054': 'CB',
 '4983': 'WR',
 '4074': 'DB',
 '3188': 'DT',
 '6791': 'CB',
 '3764': 'SS',
 '3277': 'DT',
 '3715': 'TE',
 '6211': 'LB',
 '4490': 'TE',
 '3360': 'SS',
 '7472': 'C',
 '2190': 'LB',
 '6154': 'WR',
 '2591': 'T',
 '7500': 'DT',
 '808': 'T',
 '7454': 'WR',
 '5968': 'CB',
 '2406': 'DE',
 '1546': 'RB',
 '5862': 'DE',
 '3909': 'K',
 '3172': 'DE',
 '3355': 'WR',
 '6956': 'TE',
 '7349': 'DB',
 '5177': 'SS',
 '6102': 'G',
 '7196': 'DE',
 '4231': 'DE',
 '6960': 'WR',
 '1204': 'CB',
 '2008': 'CB',
 '2364': 'T',
 '5999': 'FS',
 '5335': 'G',
 '3157': 'WR',
 '1809': 'CB',
 '3294': 'QB',
 '720': 'DE',
 '3353': 'FB',
 '3416': 'CB',
 '7154': 'LB',
 '6296': 'DE',
 '5369': 'SS',
 '5945': 'DE',
 '5099': 'LB',
 '6972': 'NT',
 '862': 'QB',
 '6396': 'TE',
 '4920': 'LS',
 '3444': 'LB',
 '5824': 'P',
 '7310': 'DT',
 '5903': 'QB',
 '5973': 'TE',
 '7221': 'G',
 '1037': 'LB',
 '2151': 'LB',
 '6976': 'C',
 '5964': 'G',
 '4220': 'LB',
 '439': 'LS',
 '5613': 'DT',
 '6856': 'CB',
 '4331': 'P',
 '3299': 'DE',
 '4611': 'CB',
 '4192': 'CB',
 '7137': 'CB',
 '5084': 'CB',
 '7144': 'LB',
 '2346': 'WR',
 '4186': 'RB',
 '4866': 'RB',
 '1549': 'DT',
 '4863': 'QB',
 '6424': 'T',
 '4579': 'OLB',
 '3038': 'G',
 '7444': 'DT',
 '5253': 'TE',
 '1383': 'NT',
 '1034': 'RB',
 'TB': 'DEF',
 '4121': 'DT',
 '6874': 'DE',
 '2474': 'TE',
 '4137': 'RB',
 '1987': 'WR',
 '3633': 'DT',
 '2216': 'WR',
 '7036': 'SS',
 '7149': 'QB',
 '1076': 'CB',
 '1558': 'DE',
 '6018': 'TE',
 '223': 'WR',
 '1244': 'WR',
 '4719': 'WR',
 '5134': 'WR',
 '6224': 'T',
 '6682': 'CB',
 '5926': 'NT',
 '4096': 'SS',
 '4226': 'FB',
 '5959': 'DB',
 '6057': 'LB',
 '3311': 'T',
 '5053': 'G',
 '1925': 'DE',
 '167': 'QB',
 '6143': 'CB',
 '5199': 'WR',
 '2431': 'RB',
 '6148': 'WR',
 '3681': 'NT',
 '903': 'P',
 '5634': 'CB',
 '6996': 'RB',
 '3503': 'WR',
 '5272': 'K',
 '7225': 'LB',
 '1640': 'NT',
 '4207': 'NT',
 '1920': 'DE',
 '3568': 'WR',
 '4971': 'DB',
 '1494': 'DE',
 '2009': 'G',
 '5933': 'CB',
 '7442': 'T',
 '4038': 'WR',
 '7485': 'LB',
 '6184': 'DB',
 '4109': 'SS',
 '1617': 'SS',
 '5306': 'LB',
 '1378': 'C',
 '6888': 'DB',
 '2015': 'DE',
 '2524': 'T',
 '6137': 'TE',
 '3189': 'CB',
 '6323': 'TE',
 '3305': 'T',
 '5828': 'WR',
 '1083': 'T',
 '1443': 'SS',
 '5269': 'TE',
 '813': 'T',
 '4205': 'LB',
 '7016': 'DB',
 '1242': 'LB',
 '846': 'DT',
 '5583': 'CB',
 '5402': 'DE',
 '6923': 'DB',
 '7138': 'CB',
 '3774': 'TE',
 '4969': 'NT',
 '5438': 'G',
 '6920': 'WR',
 '5131': 'RB',
 '2796': 'DE',
 '4903': 'LB',
 '1911': 'WR',
 '7067': 'G',
 '3303': 'LB',
 '619': 'DT',
 '7125': 'DT',
 '7124': 'DT',
 '4977': 'T',
 '3734': 'LB',
 '1884': 'C',
 '2456': 'LB',
 '6290': 'WR',
 '1657': 'LB',
 '2993': 'DT',
 '1822': 'T',
 '4191': 'LB',
 '1453': 'DE',
 '4057': 'CB',
 '7460': 'TE',
 '5374': 'WR',
 '3255': 'LB',
 '1552': 'T',
 '6619': 'CB'}

rosterid_dict = {1: 'Daniel',
 2: 'Mike',
 3: 'Torry',
 4: 'Mitch',
 5: 'Ryan',
 6: 'James',
 7: 'David',
 8: 'Bryan',
 9: 'AJ',
 10: 'Parm'}

teams, scores, projs = extract_data(page_source)
inds = [teams.index(t) for t in teams_correctly_ordered]

r = requests.get('https://api.sleeper.app/v1/league/599841620514373632/matchups/13')

starters = {rosterid_dict[rr['roster_id']]: rr['starters'] for rr in r.json()}

starters_out = {key: [players_out[v] for v in val if v in players_out] for key, val in starters.items()}

bonus_points = {key: sum([10 if v != 'QB' else 22 for v in val]) for key, val in starters_out.items()}

print(bonus_points)

bonus_array = np.array([bonus_points[t] for t in teams_correctly_ordered])


print(dict(zip(teams_correctly_ordered, projs[inds])))

scores_projs = np.c_[scores[inds], projs[inds] + bonus_array]

print(scores_projs)


np.save('scores_projs13.npy', scores_projs)

